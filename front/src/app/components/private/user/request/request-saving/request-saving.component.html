<div class="container mt-5">
  <h2>Solicitud de Ahorro</h2>
  <form [formGroup]="savingsForm" (ngSubmit)="onSubmit()">
    <div class="mb-3">
      <label for="totalSavingsAmount" class="form-label">Monto Total de Ahorro</label>
      <input
        type="number"
        class="form-control"
        id="totalSavingsAmount"
        formControlName="totalSavingsAmount"
        [max]="maxSavingsAmount"
      />
      <div *ngIf="savingsForm.get('totalSavingsAmount')?.invalid && (savingsForm.get('totalSavingsAmount')?.dirty || savingsForm.get('totalSavingsAmount')?.touched)" class="text-danger">
        <div *ngIf="savingsForm.get('totalSavingsAmount')?.errors?.['required']">Este campo es requerido.</div>
        <div *ngIf="savingsForm.get('totalSavingsAmount')?.errors?.['min']">El monto debe ser mayor a 0.</div>
        <div *ngIf="savingsForm.get('totalSavingsAmount')?.errors?.['max']">El monto no puede exceder de {{maxSavingsAmount}}.</div>
      </div>
    </div>

    <div class="mb-3">
      <label for="fortnight" class="form-label">Quincena</label>
      <select class="form-control" id="fortnight" formControlName="fortnight">
        <option value="" disabled selected>Seleccione una quincena</option>
        <option value="Primera">Primera Quincena</option>
        <option value="Segunda">Segunda Quincena</option>
      </select>
      <div *ngIf="savingsForm.get('fortnight')?.invalid && (savingsForm.get('fortnight')?.dirty || savingsForm.get('fortnight')?.touched)" class="text-danger">
        <div *ngIf="savingsForm.get('fortnight')?.errors?.['required']">Este campo es requerido.</div>
      </div>
    </div>

    <div class="mb-3">
      <label for="month" class="form-label">Mes</label>
      <select class="form-control" id="month" formControlName="month">
        <option value="" disabled selected>Seleccione un mes</option>
        <option value="Enero">Enero</option>
        <option value="Febrero">Febrero</option>
        <option value="Marzo">Marzo</option>
        <option value="Abril">Abril</option>
        <option value="Mayo">Mayo</option>
        <option value="Junio">Junio</option>
        <option value="Julio">Julio</option>
        <option value="Agosto">Agosto</option>
        <option value="Septiembre">Septiembre</option>
        <option value="Octubre">Octubre</option>
        <option value="Noviembre">Noviembre</option>
        <option value="Diciembre">Diciembre</option>
      </select>
      <div *ngIf="savingsForm.get('month')?.invalid && (savingsForm.get('month')?.dirty || savingsForm.get('month')?.touched)" class="text-danger">
        <div *ngIf="savingsForm.get('month')?.errors?.['required']">Este campo es requerido.</div>
      </div>
    </div>

    <div class="mb-3">
      <label for="savingLines" class="form-label">Líneas de Ahorro</label>
      <div formArrayName="lines">
        <div *ngFor="let line of lines.controls; let i = index" [formGroupName]="i" class="d-flex align-items-center mb-2">
          <div class="form-check flex-grow-1 w-50">
            <input class="form-check-input me-2" type="checkbox" formControlName="selected" (change)="onLineSelected(i)">
            <label class="form-check-label">
              {{ savingLines[i]?.nombre }}
            </label>
          </div>
          <input type="number" class="form-control w-50" formControlName="montoAhorrar" [disabled]="!line.get('selected')?.value">
        </div>
      </div>
    </div>

    <button type="submit" class="btn btn-primary" [disabled]="savingsForm.invalid">Enviar Solicitud</button>
  </form>

  <!-- PrimeNG Modal -->
  <p-dialog header="Confirmación" [(visible)]="showModal" [modal]="true" [closable]="false" [dismissableMask]="true">
    <p>{{ modalMessage }}</p>
    <p-footer>
      <button type="button" pButton label="Aceptar" (click)="closeModal()"></button>
    </p-footer>
  </p-dialog>
</div>
